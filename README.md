# InstantRec 🎙️

> **爆速起動録音アプリ** - 思考を止めない、脳直結の音声キャプチャ体験

## 📱 コンセプト

InstantRecは「起動即録音」をコンセプトとした革新的な録音メモアプリです。アプリアイコンをタップした瞬間に録音が開始され、アイデアやメモが消える前に素早く音声をキャプチャできます。

### ✨ 特徴

- **⚡ 爆速起動**: アプリタップ → 即録音開始
- **🎯 一点突破**: 録音機能に特化したシンプル設計
- **📊 視覚フィードバック**: 明確な録音状態表示
- **🔄 シームレス体験**: 停止 → リスト → 新録音の流れが自然
- **🤖 AI音声認識**: WhisperKitによる高精度音声テキスト化
- **☁️ クラウド連携**: Google Driveへの自動バックアップ
- **🎚️ 音声強化**: シーン別録音モードと音声最適化
- **🎨 統一UI**: 一貫したデザインシステムと視覚フィードバック
- **📱 iOS 17+対応**: 最新のSwiftUI + SwiftData実装

## 🚀 主要機能

### Core Features (MVP)
- [x] 起動と同時に録音開始
- [x] 大型停止ボタン（画面大部分をタップ可能）
- [x] 録音ファイル一覧（タイムスタンプ＋録音時間表示）
- [x] 音声再生機能
- [x] スワイプ削除

### Enhanced Features
- [x] 📍 **録音状態の明確表示**
  - 🔴 「録音中」テキスト + 点滅ドット
  - 🎛️ リアルタイム音声レベルメーター（実音声連動）
  - ⚡ ウェーブフォームのパルスアニメーション
  - 🔊 音声感度最適化（-55dB無音閾値設定）
- [x] 🔄 **スムーズナビゲーション**
  - リストからの復帰時に即新録音開始
  - 権限チェックの重複回避
  - バックグラウンド復帰時の自動録音開始
  - 録音中の一覧移動機能（録音破棄オプション付き）
- [x] 🎨 **アクセシブルUI**
  - Light/Dark mode自動対応
  - Dynamic Type対応（アクセシビリティ）
  - システムカラー採用
- [x] 📤 **共有機能**
  - iOS標準シェア機能（UIActivityViewController）
  - AirDrop、メール、クラウドサービス対応
  - セキュアなファイル共有（NSItemProvider）
- [x] ⭐ **お気に入り機能**
  - 重要な録音にスター表示
  - ワンタップでお気に入り切り替え
- [x] 🕐 **スマート時間表示**
  - 相対時間表示（3分前、昨日、一昨日）
  - 絶対時間表示（7/19、2025/1/1）
  - 状況に応じた自動切り替え
- [x] 🎵 **一覧内再生システム**
  - グローバル再生状態管理
  - 録音リスト内での直接再生・一時停止
  - リアルタイム進捗表示とプログレスバー
  - 自動競合解決（複数録音の同時再生防止）

### Advanced Features (NEW)
- [x] 🤖 **AI音声認識システム (WhisperKit)**
  - 5つのモデル選択（tiny, base, small, medium, large-v3）
  - 精度比較とデバッグ機能
  - オフライン処理（プライバシー重視）
  - CoreML最適化による高速処理
- [x] ☁️ **Google Drive統合**
  - 自動クラウドバックアップ
  - OAuth2認証とセキュアアクセス
  - 非同期アップロードキュー
  - 同期状況の可視化
- [x] 🎚️ **音声強化システム**
  - 5つの録音モード（会話、環境音、ナレーション、会議、バランス）
  - 指向性マイク制御
  - ノイズリダクション機能
  - シーン別音声最適化
- [x] ⏱️ **セグメント録音システム**
  - 15分自動分割録音
  - 長時間録音の安定性向上
  - 自動セグメント結合
  - 中断復帰機能
- [x] ⚙️ **カスタマイズ機能**
  - 録音開始方式選択（即座/カウントダウン/手動）
  - カウントダウン時間設定
  - 音声強化レベル調整
  - 設定の永続化

## 🏗️ 技術スタック

- **言語**: Swift 5.9+
- **UIフレームワーク**: SwiftUI
- **アーキテクチャ**: MVVM (Model-View-ViewModel)
- **データ永続化**: SwiftData
- **音声処理**: AVFoundation
- **AI音声認識**: WhisperKit (CoreML)
- **クラウド連携**: Google Drive API
- **最低サポートOS**: iOS 17.0
- **プロジェクト生成**: XcodeGen
- **依存関係管理**: Swift Package Manager + CocoaPods

## 📁 プロジェクト構造

```
InstantRec/
├── InstantRec.xcodeproj/          # Xcodeプロジェクト
├── InstantRec.xcworkspace/        # CocoaPods workspace
├── project.yml                    # XcodeGen設定
├── Podfile                        # CocoaPods依存関係
├── Sources/instantrec/            # ソースコード
│   ├── App/
│   │   └── InstantRecApp.swift    # アプリエントリーポイント
│   ├── Models/
│   │   ├── Recording.swift        # SwiftDataモデル（お気に入り・同期状況）
│   │   └── CloudSyncStatus.swift  # クラウド同期状態管理
│   ├── Services/
│   │   ├── AudioService.swift     # 音声処理サービス（録音モード対応）
│   │   ├── PlaybackManager.swift  # グローバル再生管理サービス
│   │   ├── WhisperKitTranscriptionService.swift # AI音声認識
│   │   ├── GoogleDriveService.swift # Google Drive連携
│   │   ├── UploadQueue.swift       # 非同期アップロードキュー
│   │   ├── AudioProcessingService.swift # 音声強化処理
│   │   └── SegmentedRecordingService.swift # セグメント録音
│   ├── ViewModels/
│   │   ├── RecordingViewModel.swift
│   │   ├── RecordingsListViewModel.swift
│   │   └── SettingsViewModel.swift
│   ├── Views/
│   │   ├── RecordingView.swift    # メイン録音画面
│   │   ├── RecordingsListView.swift
│   │   ├── PlaybackView.swift
│   │   ├── RecordingRowView.swift # 録音リスト行コンポーネント
│   │   ├── ActivityView.swift     # 共有機能コンポーネント
│   │   ├── TranscriptionDebugView.swift # AI音声認識デバッグ
│   │   ├── SettingsView.swift     # 設定画面
│   │   ├── AudioSettingsView.swift # 音声設定
│   │   ├── CountdownView.swift    # カウントダウン表示
│   │   └── SegmentedRecordingView.swift # セグメント録音専用UI
│   ├── Utils/
│   │   └── DateFormatter+Extensions.swift # スマート時間表示
│   └── Info.plist                 # アプリ設定
├── docs/                          # ドキュメント
│   ├── project-concept.md         # プロジェクトコンセプト
│   ├── technical-specification.md # 技術仕様書
│   ├── research_whisperkit.md     # WhisperKit調査結果
│   └── LONG_RECORDING_ANALYSIS.md # 長時間録音分析
└── README.md                      # このファイル
```

## 🛠️ 開発・ビルド手順

### 前提条件
- Xcode 15.4+
- iOS 17.0+ 対応デバイス
- XcodeGen (オプション、プロジェクト再生成時)
- CocoaPods (Google Drive連携用)

### セットアップ
```bash
# リポジトリをクローン
git clone https://github.com/[your-username]/instantrec.git
cd instantrec

# CocoaPods依存関係をインストール
pod install

# XcodeGenでプロジェクト生成（オプション）
xcodegen generate

# Workspaceを開く（重要: .xcworkspaceを使用）
open InstantRec.xcworkspace
```

### ビルド
1. Xcodeでworkspaceを開く（`InstantRec.xcworkspace`）
2. ターゲットデバイスを選択
3. `Cmd + R` でビルド＆実行

### 実機テスト
1. 開発者アカウントでCode Signingを設定
2. 実機を接続
3. デバイスでアプリを信頼設定
4. 爆速録音体験をテスト！

## 📋 使用方法

### 基本フロー
1. **起動**: アプリアイコンタップ
2. **許可**: 初回のみマイクロフォンアクセス許可
3. **録音**: 自動で録音開始（赤色画面＋音声レベル表示）
4. **停止**: 大型「停止」ボタンをタップ
5. **確認**: 録音リストで再生・削除が可能
6. **継続**: Backボタンで即次の録音開始

### 新機能の使い方

#### 🤖 AI音声認識
1. 設定 → TranscriptionDebugView
2. モデル選択（tiny〜large-v3）
3. 録音ファイルを選択して音声認識実行
4. 精度比較とデバッグ情報確認

#### ☁️ Google Drive連携
1. 設定でGoogle アカウントにサインイン
2. 録音ファイルが自動的にバックアップ
3. 一覧画面で同期状況を確認

#### 🎚️ 音声強化
1. 設定 → 音声設定
2. 録音モードを選択：
   - **会話**: 人の声を明瞭に、背景ノイズ抑制
   - **環境音**: すべての音を忠実に録音
   - **ナレーション**: 高品質、ノイズ最小化
   - **会議**: 複数話者対応、会議室最適化
   - **バランス**: 汎用的な設定
3. ノイズリダクションレベルを調整

#### ⏱️ セグメント録音
1. メイン画面左上「⏰ セグメント録音」
2. ファイル名を入力して録音開始
3. 15分ごとに自動分割
4. 録音完了後「セグメント結合」で統合

### UI要素
- **🔴 録音中表示**: 点滅ドット + "録音中"テキスト
- **📊 音声レベルメーター**: 20本のバーでリアルタイム表示
- **⏱️ 経過時間**: MM:SS形式のタイマー表示
- **🛑 停止ボタン**: 大型で押しやすいデザイン
- **⭐ お気に入り**: 重要な録音にスター表示
- **☁️ 同期状況**: アップロード進捗と状態表示

## 🎯 設計思想

### 「やらないことリスト」
爆速というコア価値を守るために、以下の機能は**意図的に実装していません**：

- ❌ スプラッシュスクリーン
- ❌ 複雑なフォルダ分け
- ❌ 音声編集機能（基本的な再生のみ）
- ❌ テーマ変更（システム設定追従）
- ❌ 過度な設定項目

### パフォーマンス最適化
- ✅ 最小限の外部ライブラリ
- ✅ 起動時処理の最小化
- ✅ UIの応答性維持（60fps）
- ✅ メモリ効率的な音声処理
- ✅ CoreML最適化によるAI処理高速化

### プライバシー重視
- ✅ 音声認識はオフライン処理（WhisperKit）
- ✅ Google Drive連携はユーザー選択制
- ✅ 音声ファイルのローカル保存
- ✅ セキュアな認証フロー

## 🤝 コントリビューション

このプロジェクトは「爆速起動」という一点突破のコンセプトを維持することを重視しています。

### 歓迎する改善
- 🐛 バグ修正
- ⚡ パフォーマンス改善
- 🎨 UIの洗練
- 📝 ドキュメント改善
- 🤖 AI音声認識の精度向上
- ☁️ クラウド連携の安定性向上

### 慎重に検討する機能追加
- 新機能は「爆速」に影響しないか？
- UIの複雑性は増していないか？
- 本当に必要な機能か？
- プライバシーは保護されているか？

## 📄 ライセンス

MIT License

## 👨‍💻 開発者

個人開発プロジェクトとして開発されました。

## 🏆 開発の記録

このプロジェクトは以下の開発プロセスを経て完成しました：

### Phase 1: 基盤構築
1. **コンセプト設計** (docs/project-concept.md)
2. **技術仕様策定** (docs/technical-specification.md)  
3. **MVP実装** - 基本的な録音機能
4. **UI改善** - 録音状態の明確化
5. **UX最適化** - ナビゲーションの改善

### Phase 2: 機能強化 (2025-07-19〜20)
- ✅ **リアルタイム音声レベル表示**: ダミーアニメーションから実音声連動へ
- ✅ **音声感度最適化**: 段階的調整により最適なレスポンスを実現
- ✅ **アクセシビリティ対応**: システム設定に自動追従
- ✅ **共有機能追加**: iOS標準シェア機能でAirDrop・クラウド対応
- ✅ **スマート時間表示**: 相対時間（3分前・昨日）と絶対時間の自動切り替え
- ✅ **お気に入り機能**: 重要な録音にスター表示・操作
- ✅ **UI大幅改善**: 階層的情報表示と録音品質向上
- ✅ **一覧内再生システム**: PlaybackManagerによるグローバル再生状態管理

### Phase 3: AI・クラウド統合 (2025-07-27)
- ✅ **WhisperKit音声認識**: 5つのモデル選択と精度比較機能
- ✅ **Google Drive統合**: OAuth2認証と自動バックアップ
- ✅ **音声強化システム**: 5つの録音モードと音声最適化
- ✅ **セグメント録音**: 長時間録音の安定性向上と15分自動分割
- ✅ **設定システム**: カスタマイズ可能な録音設定

### Phase 4: 安定性・最適化 (2025-07-27)
- ✅ **長時間録音問題の解決**: セグメント録音による安定性向上
- ✅ **AudioSession中断処理**: 電話着信等からの自動復帰
- ✅ **メモリ最適化**: 定期的クリーンアップと効率的リソース管理
- ✅ **権限管理強化**: 適切な権限チェックとエラーハンドリング
- ✅ **非同期処理最適化**: UIブロッキング防止と応答性向上

### 最新の技術改善 (2025-07-27)
- 🎤 **指向性マイク制御**: モード別データソース選択とゲイン調整
- 🔄 **AudioSession最適化**: 中断処理とルート変更の詳細対応
- 📊 **ディスク・メモリ監視**: リソース状況の可視化と警告システム
- 🛡️ **エラー回復機能**: 録音失敗時の自動復旧戦略
- ⏱️ **セグメント録音UI**: 専用インターフェースと進捗表示

### Phase 5: UI統一性・ユーザー体験向上 (2025-08-12)
- ✅ **UI統一化**: 録音モード間での一貫したデザインシステム実装
- ✅ **設定連動改善**: StartMode変更の即座反映機能
- ✅ **視認性向上**: アイコン・テキストサイズ最適化（.caption2→.title3）
- ✅ **文字起こしステータス**: 処理前・中・後の明確な状態表示
- ✅ **パルスアニメーション**: アクティブ状態の視覚的フィードバック
- ✅ **英語UI統一**: 国際化準備とテキスト一貫性確保
- ✅ **再生連動設計**: テキストハイライト機能の完全技術仕様書作成

### 技術的成果 (2025-08-12)
- 🎨 **統一デザインシステム**: 色・フォント・レイアウトの標準化
- 📱 **リアクティブUI**: onChange監視による即座設定反映
- 🔄 **状態管理改善**: TranscriptionStatusによる明確な処理状態
- 📐 **アクセシビリティ**: Dynamic Type対応サイズ最適化
- 📋 **設計文書化**: 再生連動ハイライト機能の実装プラン策定

## 🎯 今後の展望

### 技術的改善
- [ ] **音声品質の向上**: より高度なノイズキャンセリング
- [ ] **AI認識の高速化**: モデル最適化とキャッシュ戦略
- [ ] **クラウド同期の強化**: 差分同期と競合解決
- [ ] **バッテリー最適化**: 長時間録音時の省電力化

### 機能拡張
- [ ] **再生連動ハイライト**: 音声再生時の該当テキスト強調表示（設計完了）
- [ ] **音声要約機能**: AI による録音内容の自動要約
- [ ] **検索機能**: 音声認識結果からのテキスト検索
- [ ] **スマートタグ**: 自動的な録音分類とタグ付け
- [ ] **他クラウドサービス対応**: Dropbox, iCloud Drive等
- [ ] **国際化対応**: 多言語UI（英語ベース完了）

---

> 💡 **思考を止めない録音体験** - アイデアが消える前に、瞬時に音声化

## 📈 パフォーマンス指標

- **起動時間**: < 300ms （アプリタップから録音開始まで）
- **録音開始**: < 100ms （権限確認済み状態）
- **UI応答性**: 60fps維持
- **メモリ使用量**: < 150MB （通常録音時）
- **ディスク効率**: AAC圧縮による最適化
- **バッテリー**: 1時間録音で約10%消費

## 🔧 トラブルシューティング

### よくある問題

#### マイクの権限が取得できない
1. 設定アプリ → プライバシーとセキュリティ → マイク
2. InstantRecを有効にする
3. アプリを再起動

#### 録音が開始されない
1. 他のアプリがマイクを使用していないか確認
2. AudioSessionの競合チェック
3. デバイスの再起動を試行

#### Google Driveにアップロードされない
1. ネットワーク接続を確認
2. Google アカウントの再認証
3. アプリのネットワーク権限確認

#### 長時間録音が失敗する
1. セグメント録音機能を使用
2. 十分なストレージ容量の確保
3. バックグラウンド実行の設定確認