# タイムスタンプ機能拡張ロードマップ

## 📋 概要

音声録音アプリのタイムスタンプ機能を活用した、高度な文字起こし体験の実現を目指す実装計画です。

## 🎯 基本方針

**「データファースト」アプローチ**
- タイムスタンプデータを常時自動保存
- UI表示は後から自由に制御可能
- 機能拡張時にデータが既に存在する設計

## 🛠️ 実装フェーズ

### Phase 1: データ基盤の確立 ⭐ 【今回対象】

#### 1.1 自動タイムスタンプ保存機能
- **目的**: ユーザー設定に関わらず、常にタイムスタンプデータを取得・保存
- **実装**:
  ```swift
  // WhisperKitで常時タイムスタンプ取得
  withoutTimestamps: false  // UI設定に関わらず常にfalse
  
  // Recording.swiftでの保存
  var timestampedTranscription: String?  // JSON形式でセグメント情報保存
  var segments: [TranscriptionSegment]?  // 構造化データとしても保存
  ```

#### 1.2 データ構造の標準化
- **セグメント情報の構造化**:
  ```swift
  struct TranscriptionSegment {
      let startTime: Double    // 開始時間（秒）
      let endTime: Double      // 終了時間（秒）
      let text: String         // セグメントテキスト
      let confidence: Float?   // 信頼度（将来拡張用）
  }
  ```

#### 1.3 表示制御の分離
- **UI表示設定とデータ取得の分離**
- **既存録音への後付け対応**

### Phase 2: 表示機能の拡張 【次回セッション候補】

#### 2.1 表示モード切り替えUI
- **テキストのみモード**: `"こんにちは、今日は..."`
- **タイムスタンプ付きモード**: `"[00:02.150] こんにちは、今日は..."`
- **セグメント表示モード**: `"セグメント1 (0:02-0:05): こんにちは..."`
- **時系列表示モード**: 縦スクロールで時間軸表示

#### 2.2 RecordingDetailViewの拡張
- **表示モード選択ボタン**
- **セグメント毎の表示切り替え**
- **コピー・共有機能の拡張**

### Phase 3: インタラクティブ再生機能 【高優先】

#### 3.1 音声・テキスト同期再生
- **リアルタイムハイライト**: 再生中のテキスト部分をハイライト表示
- **自動スクロール**: 再生位置に応じてテキストを自動スクロール
- **視覚的フィードバック**: 現在再生中のセグメントを強調表示

#### 3.2 テキストからの音声操作
- **テキストタップジャンプ**: テキスト部分をタップして該当時間に音声ジャンプ
- **セグメント再生**: 特定セグメントのみをリピート再生
- **範囲選択再生**: テキスト範囲選択で対応音声部分を再生

#### 3.3 高度な再生制御
- **再生速度調整**: セグメント毎の再生速度変更
- **無音部分スキップ**: セグメント間の無音をスキップ
- **A-Bリピート**: 指定範囲の反復再生

### Phase 4: 分析・編集機能 【中優先】

#### 4.1 セグメント編集機能
- **セグメント分割**: 長いセグメントを手動分割
- **セグメント結合**: 短いセグメントを結合
- **時間調整**: セグメント境界の微調整
- **テキスト編集**: セグメント毎のテキスト修正

#### 4.2 検索・ナビゲーション機能
- **時間指定検索**: "3分頃の発言"を検索
- **キーワード検索**: 特定単語の発言時間を特定
- **ブックマーク機能**: 重要箇所のマーキング
- **目次生成**: セグメント要約からの目次自動生成

#### 4.3 統計・分析機能
- **発話時間分析**: 実際の発話時間と無音時間
- **発話速度分析**: 単語/分の計算
- **セグメント統計**: 平均セグメント長、分布
- **内容分析**: キーワード頻度、話題分類

### Phase 5: エクスポート・共有機能 【低優先】

#### 5.1 高度なエクスポート
- **時間指定エクスポート**: 特定時間範囲のみ書き出し
- **セグメント選択エクスポート**: 選択したセグメントのみ
- **フォーマット対応**: SRT、VTT、TXT等の字幕形式
- **音声付きエクスポート**: 音声ファイルと字幕ファイルのセット

#### 5.2 共有機能の拡張
- **セグメント共有**: 特定セグメントのみをシェア
- **埋め込みプレーヤー**: Webでの再生可能な共有
- **コラボレーション**: 複数人でのセグメント編集

## 📊 各フェーズの優先度と工数見積もり

| フェーズ | 優先度 | 工数見積もり | 効果 | 実装難易度 |
|---------|--------|-------------|------|-----------|
| Phase 1 | ⭐⭐⭐ | 2-3時間 | 基盤確立 | 低 |
| Phase 2 | ⭐⭐⭐ | 3-4時間 | UX向上 | 中 |
| Phase 3 | ⭐⭐⭐ | 5-6時間 | 革新的体験 | 高 |
| Phase 4 | ⭐⭐ | 4-5時間 | 専門的機能 | 中 |
| Phase 5 | ⭐ | 3-4時間 | 付加価値 | 中 |

## 🎯 今回セッションでの実装対象

### ✅ 確実に実装すべき項目（Phase 1）
1. **自動タイムスタンプ保存**: UI設定に関わらずデータ取得
2. **データ構造の標準化**: セグメント情報の構造化
3. **既存機能への統合**: 現在の文字起こしフローに組み込み

### 🔄 検討・準備項目
1. **Phase 2のUI設計**: 表示モード切り替えの準備
2. **Phase 3の技術調査**: 音声再生とテキスト同期の方法

## 🚀 将来的な発展性

### 技術拡張の可能性
- **AI要約**: セグメント毎の自動要約
- **話者識別**: 複数話者の自動識別と色分け
- **感情分析**: 音声からの感情状態推定
- **リアルタイム処理**: ライブ配信での同時字幕

### ビジネス活用
- **会議録作成**: 議事録の自動生成
- **インタビュー支援**: ジャーナリスト向け機能
- **教育分野**: 授業録音の活用
- **アクセシビリティ**: 聴覚障害者支援

## 📝 次回セッションへの引き継ぎ

### 完了予定項目
- [x] タイムスタンプ自動保存機能
- [x] データ構造の標準化
- [x] 基盤実装の完了

### 次回検討項目
- [ ] Phase 2: 表示モード切り替えUI
- [ ] Phase 3: インタラクティブ再生の詳細設計
- [ ] ユーザーフィードバックの収集と反映

---

**最終更新**: 2025-08-15
**作成者**: Claude Code セッション
**レビュー**: 次回セッション開始時