# 実機マイクテスト診断ガイド

## 現在の問題
シミュレーターでは音声レベルが常に0.000になる問題が確認されています。これは実機でのテストが必要です。

## 実機での修正内容

### 1. 音声レベル検出感度向上
- maxSampleベースのdB計算に変更
- -80dBから-10dBの実用範囲でマッピング
- 1マイクロボルト閾値での最低レベル保証

### 2. AudioSession最適化
- サンプルレート: 48000Hz (高品質)
- バッファ: 2ms (高応答性)
- カテゴリ: playAndRecord

### 3. デバッグ機能強化
- 非ゼロサンプル数カウント
- 5回に1回の詳細ログ出力
- マイク診断情報の表示

## 実機テスト手順

1. **アプリビルド**: Xcode で実機向けビルド
2. **録音開始**: 手動録音ボタンをタップ
3. **音声入力**: マイクに向かって音を出す
4. **ログ確認**: 以下を確認
   - `🎤 Buffer #X: nonZero>0`
   - `🎚️ AudioEngine Level Update: >0.000`

## 期待される改善

### Before (シミュレーター)
```
🎤 Buffer #10: frames=4800, maxSample=0.000000, rms=0.000000, dB=-163.4
🎚️ AudioEngine Level Update #10: 0.000
```

### After (実機期待値)
```
🎤 Buffer #10: frames=4800, nonZero=1200, maxSample=0.00012345, rms=0.00008765, dB=-58.1
🎚️ AudioEngine Level Update #10: 0.314 (dB: -58.1, nonZero: 1200)
```

## 追加実装項目
- [ ] マイク権限確認の強化
- [ ] AudioSession カテゴリ変更の動的対応
- [ ] バックグラウンド録音時の音声レベル維持
- [ ] 実機での最適なバッファサイズ調整